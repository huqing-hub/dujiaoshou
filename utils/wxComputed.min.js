!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.wxComputed=e()}(this,function(){"use strict";let t=0;class e{constructor(){this.subs=[],this.did=++t}addSub(t){this.subs.push(t)}depend(){e.target&&e.target.addDep(this)}notify(){this.subs.forEach(t=>t.update())}}function n(t){!function t(n){"object"==typeof n&&null!==n&&Object.keys(n).forEach(o=>{let s=n[o];const i=new e;Object.defineProperty(n,o,{set(t){s=t,i.notify()},get:()=>(i.depend(),s)}),t(s)})}(t.data)}e.target=null;let o=0;class s{constructor(t,n,s){this.vm=t,this.fn=n,this.cb=s,this.wid=++o,this.depIdMap={},this.value=this.getValue(),this.dep=new e}getValue(){e.target=this;const t=this.fn.call(this.vm);return e.target=null,t}update(){this.value=this.getValue(),"function"==typeof this.cb&&this.cb.call(this.vm),this.dep.notify()}addDep(t){this.depIdMap.hasOwnProperty(t.did)||(t.addSub(this),this.depIdMap[t.did]=t)}depend(){this.dep.depend()}}return function(t){(function({computed:t}){const e=null===t||"object"!=typeof t,n=!Object.keys(t).length;if(t&&!e&&!n)return!0;console.warn("没有computed属性或computed属性不是object")})(t)&&(n(t),function(t){const e={};for(const n in t.computed){const o=t.computed[n];"function"==typeof o?(Object.defineProperty(t.data,n,{set:function(){},get:function(){const e=new s(t,o,()=>{t.setData({[n]:e.value})});return t.data[n]=e.value,function(){return e.depend(),e.value}}()}),e[n]=t.data[n]):console.error(`${n} prop not a function in computed!!!`)}t.setData(e)}(t))}});
